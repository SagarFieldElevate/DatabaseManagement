name: Run All Scripts in Batches

on:
  schedule:
    - cron: "0 0 * * *"  # Every hour
  workflow_dispatch:

env:
  AIRTABLE_API_KEY: ${{ secrets.AIRTABLE_API_KEY }}
  GH_TOKEN: ${{ secrets.GH_TOKEN }}
  FRED_API_KEY: ${{ secrets.FRED_API_KEY }}

jobs:
  # Batch 1: 10 jobs running in parallel
  run-24h-volatility:
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install nbconvert pandas requests fredapi
      - name: Run 24h Volatility & Trading Range Script
        run: python "code/daily/24h Volatility & Trading Range.py"
        continue-on-error: true
      - name: Retry on Failure
        if: failure()
        run: python "code/daily/24h Volatility & Trading Range.py"
        continue-on-error: true

  run-bitcoin-halving:
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install nbconvert pandas requests fredapi
      - name: Run Bitcoin Halving Script
        run: python "code/event_driven/BitcoinHalving.py"
        continue-on-error: true
      - name: Retry on Failure
        if: failure()
        run: python "code/event_driven/BitcoinHalving.py"
        continue-on-error: true

  run-consumer-confidence:
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install nbconvert pandas requests fredapi
      - name: Run Consumer Confidence Script
        run: python "code/ConsumerConfidence.py"
        continue-on-error: true
      - name: Retry on Failure
        if: failure()
        run: python "code/ConsumerConfidence.py"
        continue-on-error: true

  run-gold-daily-price:
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install nbconvert pandas requests fredapi
      - name: Run Gold Daily Price Script
        run: python "code/daily/GoldDailyPrice.py"
        continue-on-error: true
      - name: Retry on Failure
        if: failure()
        run: python "code/daily/GoldDailyPrice.py"
        continue-on-error: true

  run-housing-permit:
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install nbconvert pandas requests fredapi
      - name: Run Housing Permit Script
        run: python "code/HousingPermit.py"
        continue-on-error: true
      - name: Retry on Failure
        if: failure()
        run: python "code/HousingPermit.py"
        continue-on-error: true

  run-market-cap:
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install nbconvert pandas requests fredapi
      - name: Run Market Cap Script
        run: python "code/daily/MarketCap.py"
        continue-on-error: true
      - name: Retry on Failure
        if: failure()
        run: python "code/daily/MarketCap.py"
        continue-on-error: true

  run-qqq-data:
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install nbconvert pandas requests fredapi
      - name: Run QQQ Data Script
        run: python "code/daily/QQQData.py"
        continue-on-error: true
      - name: Retry on Failure
        if: failure()
        run: python "code/daily/QQQData.py"
        continue-on-error: true

  run-volume-traded:
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install nbconvert pandas requests fredapi
      - name: Run Volume Traded Script
        run: python "code/daily/VolumeTraded.py"
        continue-on-error: true
      - name: Retry on Failure
        if: failure()
        run: python "code/daily/VolumeTraded.py"
        continue-on-error: true

  run-technicals:
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install nbconvert pandas requests fredapi
      - name: Run Technicals Script
        run: python "code/daily/Technicals.py"
        continue-on-error: true
      - name: Retry on Failure
        if: failure()
        run: python "code/daily/Technicals.py"
        continue-on-error: true

  run-retail-consumption:
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install nbconvert pandas requests fredapi
      - name: Run Retail Consumption Script
        run: python "code/monthly/retailConsumption.py"
        continue-on-error: true
      - name: Retry on Failure
        if: failure()
        run: python "code/monthly/retailConsumption.py"
        continue-on-error: true

  # Batch 2: 10 jobs running in parallel, dependent on Batch 1
  run-btc-price-daily:
    runs-on: ubuntu-latest
    continue-on-error: true
    needs:
      - run-24h-volatility
      - run-bitcoin-halving
      - run-consumer-confidence
      - run-gold-daily-price
      - run-housing-permit
      - run-market-cap
      - run-qqq-data
      - run-volume-traded
      - run-technicals
      - run-retail-consumption
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install nbconvert pandas requests fredapi
      - name: Run BTC Price Daily Script
        run: python "code/daily/BTCPriceDaily.py"
        continue-on-error: true
      - name: Retry on Failure
        if: failure()
        run: python "code/daily/BTCPriceDaily.py"
        continue-on-error: true

  run-coindesk-sentiment:
    runs-on: ubuntu-latest
    continue-on-error: true
    needs:
      - run-24h-volatility
      - run-bitcoin-halving
      - run-consumer-confidence
      - run-gold-daily-price
      - run-housing-permit
      - run-market-cap
      - run-qqq-data
      - run-volume-traded
      - run-technicals
      - run-retail-consumption
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install nbconvert pandas requests fredapi
      - name: Run CoinDesk Sentiment Script
        run: python "code/daily/CoinDeskSentiment.py"
        continue-on-error: true
      - name: Retry on Failure
        if: failure()
        run: python "code/daily/CoinDeskSentiment.py"
        continue-on-error: true

  run-currency-exchange:
    runs-on: ubuntu-latest
    continue-on-error: true
    needs:
      - run-24h-volatility
      - run-bitcoin-halving
      - run-consumer-confidence
      - run-gold-daily-price
      - run-housing-permit
      - run-market-cap
      - run-qqq-data
      - run-volume-traded
      - run-technicals
      - run-retail-consumption
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install nbconvert pandas requests fredapi
      - name: Run Currency Exchange Script
        run: python "code/daily/CurrencyExchange.py"
        continue-on-error: true
      - name: Retry on Failure
        if: failure()
        run: python "code/daily/CurrencyExchange.py"
        continue-on-error: true

  run-gdp-data:
    runs-on: ubuntu-latest
    continue-on-error: true
    needs:
      - run-24h-volatility
      - run-bitcoin-halving
      - run-consumer-confidence
      - run-gold-daily-price
      - run-housing-permit
      - run-market-cap
      - run-qqq-data
      - run-volume-traded
      - run-technicals
      - run-retail-consumption
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install nbconvert pandas requests fredapi
      - name: Run GDP Data Script
        run: python "code/GDPData.py"
        continue-on-error: true
      - name: Retry on Failure
        if: failure()
        run: python "code/GDPData.py"
        continue-on-error: true

  run-google-trending:
    runs-on: ubuntu-latest
    continue-on-error: true
    needs:
      - run-24h-volatility
      - run-bitcoin-halving
      - run-consumer-confidence
      - run-gold-daily-price
      - run-housing-permit
      - run-market-cap
      - run-qqq-data
      - run-volume-traded
      - run-technicals
      - run-retail-consumption
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install nbconvert pandas requests fredapi
      - name: Run Google Trending Script
        run: python "code/daily/GoogleTrending.py"
        continue-on-error: true
      - name: Retry on Failure
        if: failure()
        run: python "code/daily/GoogleTrending.py"
        continue-on-error: true

  run-inflation-data:
    runs-on: ubuntu-latest
    continue-on-error: true
    needs:
      - run-24h-volatility
      - run-bitcoin-halving
      - run-consumer-confidence
      - run-gold-daily-price
      - run-housing-permit
      - run-market-cap
      - run-qqq-data
      - run-volume-traded
      - run-technicals
      - run-retail-consumption
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install nbconvert pandas requests fredapi
      - name: Run Inflation Data Script
        run: python "code/monthly/InflationData.py"
        continue-on-error: true
      - name: Retry on Failure
        if: failure()
        run: python "code/monthly/InflationData.py"
        continue-on-error: true

  run-labor-force-participation:
    runs-on: ubuntu-latest
    continue-on-error: true
    needs:
      - run-24h-volatility
      - run-bitcoin-halving
      - run-consumer-confidence
      - run-gold-daily-price
      - run-housing-permit
      - run-market-cap
      - run-qqq-data
      - run-volume-traded
      - run-technicals
      - run-retail-consumption
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install nbconvert pandas requests fredapi
      - name: Run Labor Force Participation Script
        run: python "code/monthly/LaborForceParticipation.py"
        continue-on-error: true
      - name: Retry on Failure
        if: failure()
        run: python "code/monthly/LaborForceParticipation.py"
        continue-on-error: true

  run-m2-data:
    runs-on: ubuntu-latest
    continue-on-error: true
    needs:
      - run-24h-volatility
      - run-bitcoin-halving
      - run-consumer-confidence
      - run-gold-daily-price
      - run-housing-permit
      - run-market-cap
      - run-qqq-data
      - run-volume-traded
      - run-technicals
      - run-retail-consumption
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install nbconvert pandas requests fredapi
      - name: Run M2 Data Script
        run: python "code/M2Data.py"
        continue-on-error: true
      - name: Retry on Failure
        if: failure()
        run: python "code/M2Data.py"
        continue-on-error: true

  run-prices-script:
    runs-on: ubuntu-latest
    continue-on-error: true
    needs:
      - run-24h-volatility
      - run-bitcoin-halving
      - run-consumer-confidence
      - run-gold-daily-price
      - run-housing-permit
      - run-market-cap
      - run-qqq-data
      - run-volume-traded
      - run-technicals
      - run-retail-consumption
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install nbconvert pandas requests fredapi
      - name: Run Prices Script
        run: python "code/daily/PricesScript.py"
        continue-on-error: true
      - name: Retry on Failure
        if: failure()
        run: python "code/daily/PricesScript.py"
        continue-on-error: true

  run-spy-data:
    runs-on: ubuntu-latest
    continue-on-error: true
    needs:
      - run-24h-volatility
      - run-bitcoin-halving
      - run-consumer-confidence
      - run-gold-daily-price
      - run-housing-permit
      - run-market-cap
      - run-qqq-data
      - run-volume-traded
      - run-technicals
      - run-retail-consumption
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install nbconvert pandas requests fredapi
      - name: Run SPY Data Script
        run: python "code/daily/SPYData.py"
        continue-on-error: true
      - name: Retry on Failure
        if: failure()
        run: python "code/daily/SPYData.py"
        continue-on-error: true

  # Batch 3: 7 jobs running in parallel, dependent on Batch 2
  run-btc-etf-net-flow:
    runs-on: ubuntu-latest
    continue-on-error: true
    needs:
      - run-btc-price-daily
      - run-coindesk-sentiment
      - run-currency-exchange
      - run-gdp-data
      - run-google-trending
      - run-inflation-data
      - run-labor-force-participation
      - run-m2-data
      - run-prices-script
      - run-spy-data
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install nbconvert pandas requests fredapi
      - name: Run BTC ETF Net Flow Script
        run: python "code/daily/BTC ETF Net Flow.py"
        continue-on-error: true
      - name: Retry on Failure
        if: failure()
        run: python "code/daily/BTC ETF Net Flow.py"
        continue-on-error: true

  run-global-gdp:
    runs-on: ubuntu-latest
    continue-on-error: true
    needs:
      - run-btc-price-daily
      - run-coindesk-sentiment
      - run-currency-exchange
      - run-gdp-data
      - run-google-trending
      - run-inflation-data
      - run-labor-force-participation
      - run-m2-data
      - run-prices-script
      - run-spy-data
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install nbconvert pandas requests fredapi
      - name: Run Global GDP Script
        run: python "code/yearly/GlobalGDP.py"
        continue-on-error: true
      - name: Retry on Failure
        if: failure()
        run: python "code/yearly/GlobalGDP.py"
        continue-on-error: true

  run-interest-rate:
    runs-on: ubuntu-latest
    continue-on-error: true
    needs:
      - run-btc-price-daily
      - run-coindesk-sentiment
      - run-currency-exchange
      - run-gdp-data
      - run-google-trending
      - run-inflation-data
      - run-labor-force-participation
      - run-m2-data
      - run-prices-script
      - run-spy-data
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install nbconvert pandas requests fredapi
      - name: Run Interest Rate Script
        run: python "code/daily/InterestRate.py"
        continue-on-error: true
      - name: Retry on Failure
        if: failure()
        run: python "code/daily/InterestRate.py"
        continue-on-error: true

  run-liquidity-indicator:
    runs-on: ubuntu-latest
    continue-on-error: true
    needs:
      - run-btc-price-daily
      - run-coindesk-sentiment
      - run-currency-exchange
      - run-gdp-data
      - run-google-trending
      - run-inflation-data
      - run-labor-force-participation
      - run-m2-data
      - run-prices-script
      - run-spy-data
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install nbconvert pandas requests fredapi
      - name: Run Liquidity Indicator Script
        run: python "code/daily/LiquidityIndicator.py"
        continue-on-error: true
      - name: Retry on Failure
        if: failure()
        run: python "code/daily/LiquidityIndicator.py"
        continue-on-error: true

  run-stablecoin-supply:
    runs-on: ubuntu-latest
    continue-on-error: true
    needs:
      - run-btc-price-daily
      - run-coindesk-sentiment
      - run-currency-exchange
      - run-gdp-data
      - run-google-trending
      - run-inflation-data
      - run-labor-force-participation
      - run-m2-data
      - run-prices-script
      - run-spy-data
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install nbconvert pandas requests fredapi
      - name: Run StableCoin Supply Script
        run: python "code/daily/StableCoinSupply.py"
        continue-on-error: true
      - name: Retry on Failure
        if: failure()
        run: python "code/daily/StableCoinSupply.py"
        continue-on-error: true

  run-usdollar-index:
    runs-on: ubuntu-latest
    continue-on-error: true
    needs:
      - run-btc-price-daily
      - run-coindesk-sentiment
      - run-currency-exchange
      - run-gdp-data
      - run-google-trending
      - run-inflation-data
      - run-labor-force-participation
      - run-m2-data
      - run-prices-script
      - run-spy-data
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install nbconvert pandas requests fredapi
      - name: Run USDollar Index Script
        run: python "code/daily/USDollarIndex.py"
        continue-on-error: true
      - name: Retry on Failure
        if: failure()
        run: python "code/daily/USDollarIndex.py"
        continue-on-error: true

  run-unemployment-data:
    runs-on: ubuntu-latest
    continue-on-error: true
    needs:
      - run-btc-price-daily
      - run-coindesk-sentiment
      - run-currency-exchange
      - run-gdp-data
      - run-google-trending
      - run-inflation-data
      - run-labor-force-participation
      - run-m2-data
      - run-prices-script
      - run-spy-data
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install nbconvert pandas requests fredapi
      - name: Run Unemployment Data Script
        run: python "code/UnemploymentData.py"
        continue-on-error: true
      - name: Retry on Failure
        if: failure()
        run: python "code/UnemploymentData.py"
        continue-on-error: true
